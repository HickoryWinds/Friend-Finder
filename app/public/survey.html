<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Friend Finder Survey</title>
  <!-- link to bootstrap css, popper and js -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
  integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <!-- link to font awesome for graphics -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- link to stylesheet -->
  <link rel="stylesheet" href="/css">
  <!-- link to jquery -->
  <script src="https://code.jquery.com/jquery.js"></script>
</head>

<body>
  <!-- container for survey -->
  <div class='container'>
   
<!-- The Modal -->
<div id="myModal" class="modal">
  <span class="close">&times;</span>
  <img class="modal-content" id="img01">
  <div id="caption"></div>
</div>

    <!-- card for survey -->
    <div class='card'>
      <!-- card header -->
      <div class='card-header'>
         <!-- button to return to home page -->
        <div class='text-center'>
          <a href="/"><button class="btn btn-primary btn-sm" style='display: inline'>Head Home <span
                class='fa fa-home'></span></button> </a>
          <h2>Find Your Most Compatible Friend</h2>
          <h1>Take the Survey</h1>
        </div>
      </div>
      <!-- card for entering answers to survey -->
      <div class='card-body'>
        <h2>Survey Questions</h2>
        <hr>
        <h3><strong>About You</strong></h3>
          <h4>Name (required)</h4>
            <input type='text' id='name' class='form-control' required>
          <h4>Photo Image Link (required)</h4>
          <input type='url' id='photo' class='form-control' required>
          <hr>
        <!-- all questions are in separate forms so looping can be used to collect answers -->
        <h3><strong>Question 1</strong></h3>
          <h4>Your mind is always buzzing.</h4>
          <form>
            <select class="simple-select">
              <option value>Choose an Option</option>
              <option value= '1'>1 (Strongly Disagree)</option>
                <option value= '2'>2</option>
                <option value= '3'>3</option>
                <option value= '4'>4</option>
                <option value= '5'>5 (Strongly Agree)</option>
            </select>
          </form>
        <h3><strong>Question 2</strong></h3>
          <h4>Your mind is always buzzing.</h4>
          <form>
            <select class="simple-select">
                <option value>Choose an Option</option>
                <option value= '1'>1 (Strongly Disagree)</option>
                <option value= '2'>2</option>
                <option value= '3'>3</option>
                <option value= '4'>4</option>
                <option value= '5'>5 (Strongly Agree)</option>
            </select>
          </form>
        <h3><strong>Question 3</strong></h3>
          <h4>Your mind is always buzzing.</h4>
          <form>
            <select class="simple-select">
                <option value>Choose an Option</option>
                <option value= '1'>1 (Strongly Disagree)</option>
                <option value= '2'>2</option>
                <option value= '3'>3</option>
                <option value= '4'>4</option>
                <option value= '5'>5 (Strongly Agree)</option>
            </select>
          </form>
        <h3><strong>Question 4</strong></h3>
          <h4>Your mind is always buzzing.</h4>
          <form>
            <select class="simple-select">
                <option value>Choose an Option</option>
                <option value= '1'>1 (Strongly Disagree)</option>
                <option value= '2'>2</option>
                <option value= '3'>3</option>
                <option value= '4'>4</option>
                <option value= '5'>5 (Strongly Agree)</option>
            </select>
          </form>
        <h3><strong>Question 5</strong></h3>
          <h4>Your mind is always buzzing.</h4>
          <form>
            <select class="simple-select">
                <option value>Choose an Option</option>
                <option value= '1'>1 (Strongly Disagree)</option>
                <option value= '2'>2</option>
                <option value= '3'>3</option>
                <option value= '4'>4</option>
                <option value= '5'>5 (Strongly Agree)</option>
            </select>
          </form>
        <h3><strong>Question 6</strong></h3>
          <h4>Your mind is always buzzing.</h4>
          <form>
            <select class="simple-select">
                <option value>Choose an Option</option>
                <option value= '1'>1 (Strongly Disagree)</option>
                <option value= '2'>2</option>
                <option value= '3'>3</option>
                <option value= '4'>4</option>
                <option value= '5'>5 (Strongly Agree)</option>
            </select>
          </form>
        <h3><strong>Question 7</strong></h3>
          <h4>Your mind is always buzzing.</h4>
          <form>
            <select class="simple-select">
                <option value>Choose an Option</option>
                <option value= '1'>1 (Strongly Disagree)</option>
                <option value= '2'>2</option>
                <option value= '3'>3</option>
                <option value= '4'>4</option>
                <option value= '5'>5 (Strongly Agree)</option>
            </select>
          </form>
        <h3><strong>Question 8</strong></h3>
          <h4>Your mind is always buzzing.</h4>
          <form>
            <select class="simple-select">
                <option value>Choose an Option</option>
                <option value= '1'>1 (Strongly Disagree)</option>
                <option value= '2'>2</option>
                <option value= '3'>3</option>
                <option value= '4'>4</option>
                <option value= '5'>5 (Strongly Agree)</option>
            </select>
          </form>
        <h3><strong>Question 9</strong></h3>
          <h4>Your mind is always buzzing.</h4>
          <form>
            <select class="simple-select">
                <option value>Choose an Option</option>
                <option value= '1'>1 (Strongly Disagree)</option>
                <option value= '2'>2</option>
                <option value= '3'>3</option>
                <option value= '4'>4</option>
                <option value= '5'>5 (Strongly Agree)</option>
            </select>
          </form>
        <h3><strong>Question 10</strong></h3>
          <h4>Your mind is always buzzing.</h4>
          <form>
            <select class="simple-select">
                <option value>Choose an Option</option>
                <option value= '1'>1 (Strongly Disagree)</option>
                <option value= '2'>2</option>
                <option value= '3'>3</option>
                <option value= '4'>4</option>
                <option value= '5'>5 (Strongly Agree)</option>
            </select>
          </form>

          <div id="calc" class='text-center'>
              <input type="button" class="btn" id='add-button' value="Done">
          </div>
      </div>
    </div>
  </div>
  <!-- container for links -->
  <div class='container'>
    <a href='/api/friends' target='blank'>API Friends List | </a>
    <a href='https://github.com/HickoryWinds/Friend-Finder' target='blank'>GitHub Repo</a>
  </div>
<script>
// declare global variables for use in multiple modules
var answerSummary = [];
var lowNumber = 50;
var bestFriend = '';
var bestPhoto = '';

// create function to store input data when Done button pressed
$('#add-button').on('click', function(event){
  event.preventDefault();
  // answerSummary stores all answers in an array
  // loop through all the questions
  answerSummary = [];
  for (var j = 0; j < document.forms.length; j++) {
    var question = document.forms[j];
    var i;
    // add each response to answerSummary
    for (i = 0; i < question.length; i++) {
      // pull out answer from form and push to array
      answerSummary.push(question[i].value);
    }
  }
  // create newFriend profile using bracket notation
  var newFriend = 
  {
  };
  newFriend['name'] = $('#name').val().trim();
  newFriend['photo'] = $('#photo').val().trim();
  newFriend['scores'] = answerSummary;
  // post newFriend to friends list on server
  friendsQuery();
  var currentUrl = window.location.origin;
  $.post(currentUrl + '/api/friends', newFriend, function(data){
    alert('Now searching...');
    // clear form
    $('#name').val('');
    $('#photo').val('');
    for ( var k = 0; k < document.forms.length; k++){
      document.forms[k].reset();
    }
    showFriend(bestFriend, bestPhoto);
  });
});


// get the data from friends.js
function friendsQuery(){
  // set url to current path of server deployment
  var currentUrl = window.location.origin;
  // make ajax call to display data from friends.js
  $.ajax({url: currentUrl + '/api/friends', method: 'GET'})
  .done(function(friendsData){
    //loop through all friendsData
    // for (var j = 0; j < friendsData.length; j++){
    for (var j = 0; j < friendsData.length; j++){
    // compareFriends(answerSummary, friendsData[j].scores, j);
    compareFriends(answerSummary, friendsData[j], j);
    }
  });
}

// function compare Friends takes absolute value of difference 
//between corresponding elements of answerSummary and friend
function compareFriends(answerSummary, friend, counter){
  var comparison = 0;
  for ( var i = 0; i < 10; i++){
    // var diff = Math.abs(parseInt(answerSummary[i]) - parseInt(friend[i]));
    var diff = Math.abs(parseInt(answerSummary[i]) - parseInt(friend['scores[]'][i]));
    comparison += diff
  }
  if (comparison < lowNumber) {
    lowNumber = comparison;
    index = counter;
    bestFriend = friend.name;
    bestPhoto = friend.photo
  }
}

// display best match as modal
function showFriend(name, photo){
  // Get the modal
  var modal = document.getElementById("myModal");
  
  // Get the image and insert it inside the modal - use its "alt" text as a caption
  var modalImg = document.getElementById("img01");
  var captionText = document.getElementById("caption");
    modal.style.display = "block";
    modalImg.src = photo;
    captionText.innerHTML = name;
    // get <span> element that closes modal
      var span = document.getElementsByClassName("close")[0];
      
      // when user clicks on <span> (x), close modal
        span.onclick = function() { 
          modal.style.display = "none";
        }
        // reset values for next friend search
        lowNumber = 50;
        bestFriend = '';
        bestPhoto = '';
      }
      
</script>

</body>

</html>